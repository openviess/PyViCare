name: Format

# yamllint disable-line rule:truthy
on:
  push:
    branches:
      - main
      - master
  pull_request:
  workflow_dispatch:

env:
  DEFAULT_PYTHON: "3.11"

jobs:
  sort:
    name: sort testdata
    runs-on: ubuntu-latest
    steps:
      - name: ‚§µÔ∏è Check out code from GitHub
        uses: actions/checkout@v6.0.2
      - name: üöÄ Sort test response data
        run: |
          find './tests/response' \
            -maxdepth '1' \
            -type 'f' \
            -name '*.json' \
            -exec sh -c 'mv $1 $1.tmp; jq ".data|=sort_by(.feature)" --sort-keys $1.tmp > $1; rm $1.tmp' shell {} ";"
      - name: üîç Verify
        run: git diff --name-only --exit-code

  deprecations:
    name: validate deprecation database
    runs-on: ubuntu-latest
    steps:
      - name: ‚§µÔ∏è Check out code from GitHub
        uses: actions/checkout@v6.0.2
      - name: Set up Python
        uses: actions/setup-python@v6.2.0
        with:
          python-version: ${{ env.DEFAULT_PYTHON }}
      - name: Update deprecation database
        run: python check_deprecations.py --update
      - name: Verify no changes
        run: git diff --exit-code
        if: always()
